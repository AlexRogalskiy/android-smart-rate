language: android
dist: trusty
branches:
  only:
  - master
android:
  components:
  - tools
  - platform-tools
  - build-tools-29.0.2
  - android-21
  - android-29
  - extra-google-m2repository
  - extra-android-m2repository
  - sys-img-armeabi-v7a-android-21
before_script:
- echo no | android create avd --force -n test -t android-21 --abi armeabi-v7a -c
  100M
- emulator -avd test -no-audio -no-window &
- android-wait-for-emulator
- adb shell input keyevent 82 &
script:
- "./gradlew :library:clean :library:build :library:connectedCheck -PdisablePreDex
  --stacktrace"
- "./gradlew clean build connectedCheck -PdisablePreDex --stacktrace"
deploy:
  provider: script
  script: "./gradlew :library:clean :library:assembleRelease :library:bintrayUpload"
  cleanup: false
  on:
    branch: master
before_install:
- openssl aes-256-cbc -K $encrypted_556c6bd2f1bc_key -iv $encrypted_556c6bd2f1bc_iv
  -in keystore.jks.enc -out keystore.jks -d
